<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset=utf-8>
    <!--
     | Version 10.1.1
     | Copyright 2012 Esri
     |
     | Licensed under the Apache License, Version 2.0 (the "License");
     | you may not use this file except in compliance with the License.
     | You may obtain a copy of the License at
     |
     |    http://www.apache.org/licenses/LICENSE-2.0
     |
     | Unless required by applicable law or agreed to in writing, software
     | distributed under the License is distributed on an "AS IS" BASIS,
     | WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     | See the License for the specific language governing permissions and
     | limitations under the License.
    -->
    <title>Election Results</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" href="images/favicon.ico" />
    <link id="stylesheet" href='http://serverapi.arcgisonline.com/jsapi/arcgis/2.8/js/dojo/dojox/mobile/themes/iPhone/iPhone.css'
        rel='stylesheet' />
    <link href="http://serverapi.arcgisonline.com/jsapi/arcgis/2.6/js/dojo/dojox/mobile/themes/buttons.css"
        rel="stylesheet" />
    <link href="styles/electionResults.css" rel="stylesheet" type="text/css" />
    <link rel="Stylesheet" id="dynamicStyleSheet" />
    <link rel="apple-touch-icon" href="images/AppShortcutIcon.png" />
    <script type="text/javascript">
        djConfig = {
            parseOnLoad: true,
            mblHideAddressBar: false,
            baseUrl: "./",
            modulePaths: { "js": "js" }
        }
    </script>
    <script type="text/javascript" src="http://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.8compact">
    </script>
    <script src="js/modernizr-2.5.3.js" type="text/javascript"></script>
    <script src="js/utils.js" type="text/javascript"></script>
    <script src="js/locator.js" type="text/javascript"></script>
    <script src="js/infoWindow.js" type="text/javascript"></script>
    <script src="js/parsewebmap.js" type="text/javascript"></script>
    <script type="text/javascript">

        dojo.require("esri.map");
        dojo.require("esri.tasks.geometry");
        dojo.require("dojox.mobile.parser");
        dojo.require("dojox.mobile");
        dojo.require("dojo.window");
        dojo.require("esri.tasks.locator");
        dojo.require("esri.tasks.query");
        dojo.require("esri.layers.FeatureLayer");
        dojo.require("dojo.string");
        dojo.require("dojox.charting.Chart2D");
        dojo.require("dojox.charting.themes.ThreeD");
        dojo.require("js.config");
        dojo.require("dojo.date.locale");
        dojo.require("js.date");

        var map;
        var isiOS = false;
        var isBrowser = false;
        var isMobileDevice = false;
        var isTablet = false;
        var zoomLevel;
        var locator;
        var leftOffsetCarosuel = 0;    //Variable to store the new left value for carrosuel of Elected Offices
        var newLeft = 0
        var selectedMapPoint;
        var selectedGraphic = null;
        var currentIndex = 0;
        var electionResultData;
        var currentSelectedLayer = null;
        var currentSelectedPrecinct = null;
        var baseMapLayers;
        var mapSharingOptions;
        var geometryService;
        var precinctLayer;
        var infoBoxWidth;
        var electionResultData;
        var colorCodeOfParties;
        var numberOfContests = 0;
        var nullValueString;
        var votedColor;
        var didNotVoteColor;
        var hosizontalPosition = 0;
        var touchStart = false;
        var locatorFields;
        var referenceOverlayLayer;
        var updates;

        function init() {
            esri.config.defaults.io.proxyUrl = "proxy.ashx";        //Setting to use proxy file
            esriConfig.defaults.io.alwaysUseProxy = false;
            esriConfig.defaults.io.timeout = 180000;    //esri request timeout value


            if (!Modernizr.geolocation) {
                dojo.byId("tdGps").style.display = "none";
            }

            var userAgent = window.navigator.userAgent;
            if (userAgent.indexOf("iPhone") >= 0 || userAgent.indexOf("iPad") >= 0) {
                isiOS = true;
            }

            if (userAgent.indexOf("Android") >= 0 || userAgent.indexOf("iPhone") >= 0) {
                isMobileDevice = true;
                dojo.byId('dynamicStyleSheet').href = "styles/mobile.css";
                dojo.byId('divSplashContent').style.fontSize = "15px";
            }
            else if (userAgent.indexOf("iPad") >= 0) {
                isTablet = true;
                dojo.byId('dynamicStyleSheet').href = "styles/tablet.css";
                dojo.byId('divSplashContent').style.fontSize = "14px";
            }
            else {
                isBrowser = true;
                dojo.byId('dynamicStyleSheet').href = "styles/browser.css";
                dojo.byId('divSplashContent').style.fontSize = "11px";
            }

            if (isMobileDevice) {
                dojo.byId('divSplashScreenDialog').style.width = "95%";
                dojo.byId('divSplashScreenDialog').style.height = "95%";
                dojo.byId('divAddressContainer').style.display = "none";
                dojo.replaceClass("divAddressContainer", "", "hideContainer");
                dojo.byId("divLogo").style.display = "none";
                dojo.byId("divBottomPanelHeader").style.display = "none";
                dojo.byId("divBottomPanelBody").style.display = "none";
                dojo.byId("lblAppName").style.display = "none";
                dojo.byId("lblAppName").style.width = "80%";
            }
            else {
                dojo.byId('divSplashScreenDialog').style.width = "350px";
                dojo.byId('divSplashScreenDialog').style.height = "290px";
                dojo.byId("divLogo").style.display = "block";
            }

            var responseObject = new js.config();

            baseMapLayers = responseObject.BaseMapLayers;
            mapSharingOptions = responseObject.MapSharingOptions;
            locatorFields = responseObject.LocatorFields;
            precinctLayer = responseObject.PrecinctLayer;
            infoBoxWidth = responseObject.InfoBoxWidth;
            electionResultData = responseObject.ElectionResultData;
            colorCodeOfParties = responseObject.ColorCodeOfParties;
            nullValueString = responseObject.ShowNullValueAs;
            votedColor = responseObject.VotedColor;
            didNotVoteColor = responseObject.DidNotVoteColor;
            referenceOverlayLayer = responseObject.ReferenceOverlayLayer;
            dojo.byId('imgApplication').src = responseObject.ApplicationIcon;
            updates = responseObject.Updates;
            dojo.byId('divSplashContent').innerHTML = responseObject.SplashScreenMessage;

            dojo.byId("txtAddress").onkeypress = function (evt) {
                if (evt) {
                    var key = evt.which || evt.keyCode;
                    if (key == 13) {
                        dojo.byId("txtAddress").blur();
                        LocateAddress();
                    }
                }
            };

            geometryService = new esri.tasks.GeometryService(responseObject.GeometryService);

            locator = new esri.tasks.Locator(responseObject.LocatorURL);

            dojo.byId("lblAppName").innerHTML = responseObject.ApplicationName;
            dojo.connect(dojo.byId('imgHelp'), "onclick", function () {
                window.open(responseObject.HelpURL);
            });
            dojo.byId("txtAddress").setAttribute("defaultAddress", responseObject.LocatorDefaultAddress);
            dojo.byId("txtAddress").setAttribute("defaultPrecinct", responseObject.LocatorDefaultPrecinct);
            dojo.byId("txtAddress").value = responseObject.LocatorDefaultAddress;

            ShowProgressIndicator('map');

            if (responseObject.UseWebmap) {
                var webMapData = getWebMapInfo("electionResultsKey", responseObject.WebMapId);
                webMapData.addCallback(function (webMapDetails) {
                    electionResultData = {};
                    referenceOverlayLayer.ServiceUrl = webMapDetails.basemap.url;
                    for (var i = 0; i < webMapDetails.operationalLayers.length; i++) {
                        if (webMapDetails.operationalLayers[i].popupInfo) {
                            if (webMapDetails.operationalLayers[i].popupInfo.mediaInfos.length > 0) {
                                electionResultData[webMapDetails.operationalLayers[i].id] = {};
                                electionResultData[webMapDetails.operationalLayers[i].id]["Title"] = dojo.trim(webMapDetails.operationalLayers[i].title.split("-")[1]);
                                electionResultData[webMapDetails.operationalLayers[i].id]["HeaderColor"] = "#393939";
                                electionResultData[webMapDetails.operationalLayers[i].id]["ServiceUrl"] = webMapDetails.operationalLayers[i].url;
                                electionResultData[webMapDetails.operationalLayers[i].id]["ChartData"] = [];
                                electionResultData[webMapDetails.operationalLayers[i].id]["PartyDetails"] = [];
                                electionResultData[webMapDetails.operationalLayers[i].id]["CandidateNames"] = [];
                                electionResultData[webMapDetails.operationalLayers[i].id]["DisplayOnLoad"] = webMapDetails.operationalLayers[i].visibility;
                                for (var fieldInfo in webMapDetails.operationalLayers[i].popupInfo.fieldInfos) {
                                    if (webMapDetails.operationalLayers[i].popupInfo.fieldInfos[fieldInfo].visible) {
                                        electionResultData[webMapDetails.operationalLayers[i].id]["TotalBallots"] = webMapDetails.operationalLayers[i].popupInfo.fieldInfos[fieldInfo].fieldName;
                                        break;
                                    }
                                }

                                for (var x in webMapDetails.operationalLayers[i].popupInfo.mediaInfos[0].value.fields) {
                                    electionResultData[webMapDetails.operationalLayers[i].id]["ChartData"].push(webMapDetails.operationalLayers[i].popupInfo.mediaInfos[0].value.fields[x]);
                                }
                                var results = webMapDetails.operationalLayers[i].popupInfo.mediaInfos[0].caption.split(/\r\n|\r|\n/);
                                for (var index in results) {
                                    var val = results[index].replace(/\{/g, '');
                                    val = val.split("}");
                                    if (val.length > 1) {
                                        electionResultData[webMapDetails.operationalLayers[i].id]["PartyDetails"].push(val[1]);
                                        electionResultData[webMapDetails.operationalLayers[i].id]["CandidateNames"].push(val[0]);
                                    }
                                }
                                electionResultData[webMapDetails.operationalLayers[i].id]["ChartType"] = webMapDetails.operationalLayers[i].popupInfo.mediaInfos[0].type;
                            }
                            else {
                                precinctLayer.Key = webMapDetails.operationalLayers[i].id;
                                precinctLayer.ServiceUrl = webMapDetails.operationalLayers[i].url;
                                precinctLayer.UseColor = true;
                            }
                        }
                    }
                    Initialize(responseObject.DefaultExtent);
                });
            }
            else {
                Initialize(responseObject.DefaultExtent);
            }
            dojo.xhrGet({
                url: "errorMessages.xml",
                handleAs: "xml",
                preventCache: true,
                load: function (xmlResponse) {
                    messages = xmlResponse;
                }
            });
            dojo.connect(window, "onkeydown", function (e) {
                if (e.keyCode == 9) {
                    dojo.stopEvent(e);
                }
            });
        }

        //function to initilaze map after reading the config settings
        function Initialize(defaultExtent) {

            var infoWindow = new mobile.InfoWindow({
                domNode: dojo.create("div", null, dojo.byId("map"))
            });

            map = new esri.Map("map", { slider: true, infoWindow: infoWindow });

            var basemap = new esri.layers.ArcGISTiledMapServiceLayer(baseMapLayers[0].MapURL, { id: baseMapLayers[0].Key });
            map.addLayer(basemap);

            dojo.connect(map.getLayer(baseMapLayers.Key), "onLoad", function (e) {
                zoomLevel = e.scales.length - 2;
            });

            dojo.connect(map, "onLoad", function () {
                MapInitFunction();
                var mapExtent = defaultExtent.split(',');
                var extent = GetQuerystring('extent');
                if (extent != "") {
                    mapExtent = extent.split(',');
                }
                var precinct = GetQuerystring('precinct');
                if (precinct != "") {
                    SearchPrecinctName(unescape(precinct));
                    return;
                }
                mapExtent = new esri.geometry.Extent(parseFloat(mapExtent[0]), parseFloat(mapExtent[1]), parseFloat(mapExtent[2]), parseFloat(mapExtent[3]), map.spatialReference);
                map.setExtent(mapExtent);
            });
        }

        //function when the map is inititalized
        function MapInitFunction() {
            if (!isMobileDevice) {
                window.onresize = function () {
                    resizeHandler();
                }
            }

            var mapSlider = dojo.query(".esriSimpleSlider", this.domNode);
            if (mapSlider.length > 0) {
                dojo.addClass(mapSlider[0], "roundedCorner");
            }

            dojo.byId('divSplashScreenContainer').style.display = "block";

            dojo.addClass(dojo.byId('divSplashScreenDialog'), "divSplashScreenDialogContent");
            dojo.replaceClass("divSplashScreenDialog", "showContainer", "hideContainer");
            SetHeightSplashScreen();

            var pLayer = new esri.layers.FeatureLayer(precinctLayer.ServiceUrl, {
                mode: esri.layers.FeatureLayer.MODE_SELECTION,
                outFields: ["*"]

            });
            pLayer.id = precinctLayer.Key;
            map.addLayer(pLayer);
            if (precinctLayer.UseColor) {
                var precinctSymbol = new esri.symbol.SimpleFillSymbol();
                var precinctColor = new dojo.Color(precinctLayer.Color);
                precinctColor.a = precinctLayer.Alpha;
                precinctSymbol.setColor(precinctColor);
                var precinctRederer = new esri.renderer.SimpleRenderer(precinctSymbol);
                pLayer.setRenderer(precinctRederer);
            }

            dojo.connect(pLayer, "onClick", function (evt) {
                if (!isMobileDevice) {
                    if (currentSelectedLayer) {
                        ShowInfoWindow(evt.mapPoint, evt.graphic.attributes[precinctLayer.PrecinctName]);
                    }
                    dojo.stopEvent(evt);
                }
            });

            dojo.connect(map, "onExtentChange", function (evt) {
                if (!isOrientationChanged) {
                    if (selectedGraphic) {
                        var screenPoint = map.toScreen(selectedGraphic);
                        screenPoint.y = map.height - screenPoint.y;
                        map.infoWindow.setLocation(screenPoint);
                        return;
                    }
                }
            });

            CreateElectionResultLayOut();

            var layer;
            for (var election in electionResultData) {
                layer = electionResultData[election];
            }
            var queryTask = new esri.tasks.QueryTask(layer.ServiceUrl);
            var query = new esri.tasks.Query();
            query.where = "1=1";
            query.returnGeometry = false;
            query.outFields = [updates.FieldName];
            queryTask.execute(query, function (featureSet) {
                var utcMilliseconds = Number(featureSet.features[0].attributes[updates.FieldName]);
                var date = new js.date();
                featureSet.features[0].attributes[updates.FieldName] = dojo.date.locale.format(date.utcToLocal(date.utcTimestampFromMs(utcMilliseconds)), { datePattern: updates.FormatDateAs, timePattern: updates.FormatTimeAs });
                dojo.byId('tdLastUpdate').innerHTML = featureSet.fields[0].alias + ": " + featureSet.features[0].attributes[updates.FieldName];
                dojo.byId("divResultsUpdateInfo").style.display = "block";
            });

            if (referenceOverlayLayer.DisplayOnLoad) {
                var overlaymap = new esri.layers.ArcGISTiledMapServiceLayer(referenceOverlayLayer.ServiceUrl);
                map.addLayer(overlaymap);
            }
            HideProgressIndicator();

            dojo.connect(dojo.byId('divElectionResultsContainer'), "touchstart", function (e) {
                hosizontalPosition = e.touches[0].pageX;
                touchStart = true;
            });

            dojo.connect(dojo.byId('divElectionResultsContainer'), "touchmove", function (e) {
                if (touchStart) {
                    touchStart = false;
                    var touch = e.touches[0];
                    e.cancelBubble = true;
                    if (e.stopPropagation) e.stopPropagation();
                    e.preventDefault();
                    if (touch.pageX - hosizontalPosition >= 2) {
                        setTimeout(function () {
                            SlidePrev();
                        }, 100);
                    }
                    if (hosizontalPosition - touch.pageX >= 2) {
                        setTimeout(function () {
                            SlideNext();
                        }, 100);
                    }
                }
            });

            dojo.connect(dojo.byId('divElectionResultsContainer'), "touchend", function (e) {
                hosizontalPosition = 0
                touchStart = false;
            });
            if (dojo.query('.logo-med', dojo.byId('map')).length > 0) {
                dojo.query('.logo-med', dojo.byId('map'))[0].id = "esriLogo";
            }
            else if (dojo.query('.logo-sm', dojo.byId('map')).length > 0) {
                dojo.query('.logo-sm', dojo.byId('map'))[0].id = "esriLogo";
            }
        }

        //function to create Election Results layout
        function CreateElectionResultLayOut() {
            if (isMobileDevice) {   //If mobile device, list items are created
                var listServiceTypesContainer = dijit.byId('listElectionContenderContainer');
                for (var index in electionResultData) {
                    var li = dojo.create("LI");
                    listServiceTypesContainer.containerNode.appendChild(li);
                    var itemWidget = new dojox.mobile.ListItem({
                        label: electionResultData[index].Title.trimString(20),
                        icon: "images/arrow.png",
                        id: "li_" + index
                    }, li);
                    itemWidget.startup();

                    itemWidget.domNode.setAttribute("key", index);
                    dojo.connect(itemWidget.domNode, "onclick", function (e) {
                        dojo.byId('divElectionContenderContainer').style.display = "none";
                        dojo.byId("divRepresentativeDataScrollContainer").style.display = "block";
                        RemoveChildren(dojo.byId('divRepresentativeScrollContent'));
                        var key = this.getAttribute("key");
                        FetchContestData(electionResultData[key], key, null, map.getLayer(precinctLayer.Key).getSelectedFeatures()[0].attributes.NAME, true);

                        dojo.byId("tdList").style.display = "block";
                        dojo.byId("tdListHeader").innerHTML = "Precinct: " + map.getLayer(precinctLayer.Key).getSelectedFeatures()[0].attributes.NAME;
                    });
                }

                if (listServiceTypesContainer.redrawBorders) {
                    listServiceTypesContainer.redrawBorders();
                }
            }
            else {  //If not mobile device bottom panel is created and dynamic map services are added to the map
                for (var index in electionResultData) {
                    var td = document.createElement("td");
                    var templateNode = dojo.byId("divTemplateBox");
                    var dataContainerNode = templateNode.cloneNode(true);
                    dataContainerNode.style.display = "block";
                    dataContainerNode.id = "div" + index;
                    dataContainerNode.style.width = infoBoxWidth + "px";

                    var dataContainerHeader = dojo.query(".spanHeader", dataContainerNode)[0];
                    dataContainerHeader.innerHTML = electionResultData[index].Title;
                    var dataContainer = dojo.query(".divContentStyle", dataContainerNode);
                    dataContainer[0].id = "div" + index + "container";
                    dataContainer[1].id = "div" + index + "content";

                    td.appendChild(dataContainerNode);

                    var candidateLinktd = document.createElement("td");
                    candidateLinktd.setAttribute("candidateLinkId", index);
                    candidateLinktd.setAttribute("position", numberOfContests);
                    numberOfContests++;
                    candidateLinktd.style.borderRight = "1px solid white";
                    candidateLinktd.style.fontSize = "10px";

                    var divCandidateLink = document.createElement("div");
                    divCandidateLink.id = "divContest" + index;
                    candidateLinktd.appendChild(divCandidateLink);
                    candidateLinktd.onclick = function () {
                        map.setExtent(map.getLayer(precinctLayer.Key).fullExtent);
                        HideInformationContainer();
                        var key = this.getAttribute("candidateLinkId");
                        dojo.query('.border', dojo.byId("divElectionResultsContent")).forEach(function (node, index, arr) {
                            dojo.removeClass(node, "border");
                        });
                        dojo.addClass(dojo.byId('div' + key), "border");
                        if (dojo.byId('div' + key).style.display == "block") {
                            var hiddenContests = 0;
                            for (var index in electionResultData) {
                                if (index == key)
                                    break;
                                if (dojo.byId('div' + index).style.display == "none") {
                                    hiddenContests++;
                                }
                            }
                            var position = Number(this.getAttribute("position")) - hiddenContests;
                            SlideLeft((position * infoBoxWidth) + (position * 4));
                        }
                        ShowDynamicMap(key);
                        currentSelectedLayer = key;
                        currentSelectedPrecinct = this.children[0].title;
                        HideBottomPanel();
                    }
                    dojo.byId("trElectionResults").appendChild(td);
                    dojo.byId("trElectionContest").appendChild(candidateLinktd);
                    map.addLayer(CreateDynamicMapServiceLayer(index, electionResultData[index].ServiceUrl));

                    if (electionResultData[index].DisplayOnLoad && !currentSelectedLayer) {
                        ShowDynamicMap(index);
                        currentSelectedPrecinct = electionResultData[index].Title;
                    }
                }
                FixWidthBottomPanel();
            }

            //Event handler for map click to fetch the contest details for the selected precinct
            dojo.connect(map, "onClick", function (evt) {
                map.infoWindow.hide();
                evt.mapPoint.spatialReference = map.spatialReference;
                FindPrecinctLayer(evt.mapPoint, null, (!currentSelectedLayer) ? true : false);
            });
        }

        dojo.addOnLoad(init);
    </script>
</head>
<body onorientationchange="orientationChanged();">
    <div id="mapView" style="width: 100%; height: 100%;">
        <div id="map" style="width: 100%; height: 100%;">
        </div>
    </div>
    <div id="divSplashScreenContainer" class="divSplashScreenContainer" style="display: none;">
        <table style="width: 100%; height: 100%;">
            <tr align="center" valign="middle">
                <td>
                    <div id="divSplashScreenDialog" class="hideContainer divSplashScreenDialog">
                        <table style="width: 100%;">
                            <tr>
                                <td>
                                    <div id="divSplashContainer" class="divSplashContainer" style="margin-top: 10px;">
                                        <div id="divSplashContent" class="divSplashContent">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td align="center">
                                    <div style="width: 75px;" class="customButton" onclick="HideSplashScreenMessage();">
                                        <div class="customButtonInner">
                                            <table style="width: 100%; height: 100%;">
                                                <tr>
                                                    <td align="center" valign="middle">
                                                        OK
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div id="divLogo" class="divLogo">
        <table style="width: 100%; height: 100%;">
            <tr>
                <td>
                    <img id="imgApplication" class="imgApplication" src="images/logo.png" />
                </td>
            </tr>
        </table>
    </div>
    <div class="divApplicationHeader" align="right">
        <table cellpadding="0" cellspacing="0" class="tableHeader">
            <tr>
                <td id="lblAppName" class="lblAppName" align="left">
                </td>
                <td align="right">
                    <table>
                        <tr>
                            <td align="center" id="settings" class="tdHeader">
                                <img alt="Settings" src="images/locate.png" class="imgOptions" title="Search" onclick="ShowLocateContainer();" />
                            </td>
                            <td align="center" id="tdGps" class="tdHeader">
                                <img alt="Settings" src="images/gps.png" class="imgOptions" title="Locate" onclick="ShowMyLocation();" />
                            </td>
                            <td align="center" class="tdHeader">
                                <img src="images/share.png" class="imgOptions" title="Share" onclick="ShowSharingContainer();" />
                            </td>
                            <td align="center" id="help" class="tdHeader">
                                <img src="images/help.png" title="Help" id="imgHelp" class="imgOptions" />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
    <div id="divResultsUpdateInfo" class="divResultsUpdateInfo" style="display: none">
        <table style="height: 100%">
            <tr>
                <td id="tdLastUpdate">
                </td>
            </tr>
        </table>
    </div>
    <div id="divAddressContainer" align="center" class="hideContainerHeight divAddressContainer">
        <table style="width: 100%; height: 100%;">
            <tr align="center" valign="middle">
                <td>
                    <div id="divAddressContent" class="hideContainerHeight divAddressContent">
                        <table class="tblHeader" style="width: 100%;">
                            <tr style="height: 30px;" valign="top">
                                <td class="tdHeader" id="tdSearchTitle" align="left" valign="middle" style="padding-left: 8px;">
                                </td>
                                <td style="width: 10%;" align="right">
                                    <img src="images/close.png" class="imgOptions" style="cursor: pointer;" onclick="HideAddressContainer();" />
                                </td>
                            </tr>
                        </table>
                        <div id="divAddressResultContainer" class="divAddressResultContainer">
                            <table cellpadding="0" cellspacing="0" style="color: #fff; width: 100%;">
                                <tr>
                                    <td align="left" valign="middle" style="width: 100px;">
                                        Search by:
                                    </td>
                                    <td id="tdsearchAddress" class="tdSearchByAddress" onclick="SearchByAddress();">
                                        Address
                                    </td>
                                    <td id="tdSearchPrecinct" class="tdSearchByUnSelectedPrecinct" onclick="SearchByPrecinct();">
                                        Precinct
                                    </td>
                                    <td style="width: 20px;">
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <div align="left" id="divAddressPlaceHolder" class="divAddressPlaceHolder">
                                            <input type="text" id="txtAddress" class="txtAddress" onfocus="if(this.setSelectionRange)this.setSelectionRange(this.value.length, this.value.length);" />
                                            <img src="images/locate.png" id="imgLocate" class="imgLocate" title="Locate" onclick="LocateAddress();" />
                                        </div>
                                        <div id="divAddressList" align="left" class="divAddressList">
                                            <div id="divAddressScrollContainer" class="divAddressScrollContainer">
                                                <div id="divAddressScrollContent" class="divAddressScrollContent">
                                                    <table id="tblAddressResults" cellpadding="0" cellspacing="2" style="width: 100%;">
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div id="divShareContainer" class="hideContainerHeight divShareContainer">
        <div id="divShareContentHolder" class="divShareContentHolder" style="height: 100%;">
            <div id="divAppContent">
                <table cellpadding="0" cellspacing="0">
                    <tr>
                        <td>
                            <table cellpadding="2" cellspacing="2">
                                <tr>
                                    <td align="center" colspan="3" style="color: #F5F5DC;">
                                        Share this map
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 30px;" align="center">
                                        <img title="Facebook" class="imgShare" src="images/img_facebook.png" onclick="Share('facebook');" />
                                    </td>
                                    <td style="width: 30px;" align="center">
                                        <img title="Twitter" class="imgShare" src="images/img_twitter.png" onclick="Share('twitter');" />
                                    </td>
                                    <td style="width: 30px;" align="center">
                                        <img title="Email" class="imgShare" src="images/img_email.png" onclick="Share('mail');" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div id="divBottomPanelHeader" class="hideHeaderContainer divBottomPanelHeader">
        <table style="width: 100%; height: 100%;">
            <tr>
                <td align="left" style="width: 89%; height: 100%; padding-left: 5px;">
                    <span id="spanAddress" class="spanHeader"></span>
                </td>
                <td align="center">
                    <div id="divToggle" title="Hide results">
                        <img src="images/down.png" id="imgToggle" class="imgShare" state="minimized" onclick="ShowHideBottomPanel();" />
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div id="divBottomPanelBody" class="hideBottomContainer divBottomPanelBody">
        <div id="divBottomPanelContent" style="height: 100%;">
            <table cellspacing="0" style="width: 100%; height: 100%;">
                <tr>
                    <td align="center">
                        <div style="width: 40px">
                            <div id="divSlideLeft" style="display: none; vertical-align: middle; cursor: pointer;"
                                onclick="SlidePrev()">
                                <img src="images/arrLeft.PNG" class="imgOptions" />
                            </div>
                        </div>
                    </td>
                    <td style="width: 100%;">
                        <div id="divElectionResultsContainer" class="divElectionResultsContainer">
                            <div id="divElectionResultsContent" class="divElectionResultsContent" style="height: 200px;">
                                <table style="height: 100%;" cellspacing="0" cellpadding="0">
                                    <tr id="trElectionResults" style="height: 100%;">
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </td>
                    <td align="right">
                        <div style="width: 40px">
                            <div id="divSlideRight" style="vertical-align: middle; cursor: pointer;" onclick="SlideNext();">
                                <img src="images/arrRight.png" class="imgOptions" />
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3" style="border-top: 1px solid white; cursor: pointer;">
                        <div id="divElectionContestContainer" class="divElectionContestContainer">
                            <div id="divElectionContestContent" class="divElectionContestContent" style="height: 20px;">
                                <table style="width: 100px; height: 100%;">
                                    <tr id="trElectionContest">
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="divTemplateBox" class="divTemplateBox">
        <div class="divTemplateHeader">
            <table style="height: 100%; width: 100%">
                <tr>
                    <td>
                        <span class="spanHeader"></span>
                    </td>
                </tr>
            </table>
        </div>
        <div class="divContentStyle">
            <div class="divContentStyle">
            </div>
        </div>
    </div>
    <div id="divElectionResultsView" class="opacityHideAnimation divElectionResultsView"
        style="display: none;">
        <table style="width: 100%; height: 100%;">
            <tr align="center" valign="middle">
                <td>
                    <div id="divElectionContenderDetails" class="hideContainer divElectionContenderDetails">
                        <table class="tblHeader" style="width: 100%;">
                            <tr style="height: 30px;" align="center" valign="top">
                                <td style="width: 2px;">
                                </td>
                                <td id="tdListHeader" class="tdListHeader" align="left" valign="middle">
                                </td>
                                <td id="tdList" style="display: none;" align="right">
                                    <img src="images/back.png" class="imgOptions" style="cursor: pointer;" onclick="ReturnElectionContenderContainer();" />
                                </td>
                                <td style="width: 40px;" align="right">
                                    <img src="images/close.png" class="imgOptions" style="cursor: pointer;" onclick="HideElectionContenderContainer();" />
                                </td>
                            </tr>
                        </table>
                        <div id="divElectionContenderContainer">
                            <div id="divElectionContenderList">
                                <div id="divElectionContainer" class="divElectionContainer">
                                    <div id="divElectionContent" class="divElectionContent">
                                        <ul id="listElectionContenderContainer" dojotype="dojox.mobile.EdgeToEdgeList">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div align="center" id="divRepresentativeDataScrollContainer" class="divRepresentativeDataScrollContainer"
                            style="width: 100%;">
                            <div id="divRepresentativeScrollContent" class="divRepresentativeScrollContent">
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div id="divInfowindowContent">
        <table class="tblHeader" style="width: 100%;">
            <tr style="height: 30px;" align="center" valign="top">
                <td id="tdTitle" class="tdHeader" align="left" valign="middle" style="padding-left: 8px;">
                    Precinct:
                </td>
                <td align="right" style="width: 10%;">
                    <img src="images/close.png" class="imgOptions" style="cursor: pointer;" onclick="HideInformationContainer();" />
                </td>
            </tr>
        </table>
        <div id="divResultChartContainer" class="divResultChartContainer">
        </div>
    </div>
    <div id="divLoadingIndicator" class="divLoadingIndicator" style="display: none;">
        <table style="width: 100%; height: 100%;">
            <tr align="center" valign="middle">
                <td>
                    <img src="images/loader.gif" />
                </td>
            </tr>
        </table>
    </div>
</body>
</html>
